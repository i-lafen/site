import{_ as s,o as n,c as a,Q as p}from"./chunks/framework.281e52d7.js";const u=JSON.parse('{"title":"Micro App","description":"","frontmatter":{},"headers":[],"relativePath":"microfe/microapp.md","filePath":"microfe/microapp.md","lastUpdated":1703045995000}'),l={name:"microfe/microapp.md"},o=p(`<h1 id="micro-app" tabindex="-1">Micro App <a class="header-anchor" href="#micro-app" aria-label="Permalink to &quot;Micro App&quot;">â€‹</a></h1><h2 id="æ¦‚å¿µ" tabindex="-1">æ¦‚å¿µ <a class="header-anchor" href="#æ¦‚å¿µ" aria-label="Permalink to &quot;æ¦‚å¿µ&quot;">â€‹</a></h2><p>è§£å†³é¡¹ç›®ä½“ç§¯è¿‡å¤§é—®é¢˜ï¼Œå¤§é¡¹ç›®æ¯æ¬¡æ›´æ–°ä¸€æ¬¡ç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œå€Ÿé‰´äºå¾®æœåŠ¡ï¼Œå¾®å‰ç«¯å¯ä»¥å°†é¡¹ç›®æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­é¡¹ç›®å•ç‹¬éƒ¨ç½²ã€‚ <a href="https://cangdu.org/micro-app/docs.html#/" target="_blank" rel="noreferrer">micro-app</a> èƒ½å¤Ÿè®©æ—§é¡¹ç›®å¿«é€Ÿæ¥å…¥å¾®å‰ç«¯ã€‚</p><p><code>micro-app</code> å€Ÿé‰´äº <code>WebComponent</code> ï¼Œé€šè¿‡ <code>CustomElement</code> ç»“åˆè‡ªå®šä¹‰çš„ <code>ShadowDom</code> ï¼Œå°†å¾®å‰ç«¯å°è£…æˆä¸€ä¸ªç±» <code>WebComponent</code> ç»„ä»¶ï¼Œä»è€Œå®ç°å¾®å‰ç«¯çš„ç»„ä»¶åŒ–æ¸²æŸ“ã€‚</p><p>è€Œä¸”æ¥å…¥ç®€å•ï¼ŒåŒæ—¶ <code>micro-app</code> è¿˜æä¾›äº† <code>js</code>æ²™ç®±ã€æ ·å¼ã€å…ƒç´ åˆ†ç¦»ã€é¢„åŠ è½½ã€æ•°æ®é€šä¿¡ã€é™æ€èµ„æºè¡¥å…¨ ç­‰ä¸€ç³»åˆ—å®Œå–„çš„åŠŸèƒ½ï¼Œå¹¶å…¼å®¹æ‰€æœ‰æ¡†æ¶ã€‚</p><h2 id="å¿«é€Ÿä¸Šæ‰‹" tabindex="-1">å¿«é€Ÿä¸Šæ‰‹ <a class="header-anchor" href="#å¿«é€Ÿä¸Šæ‰‹" aria-label="Permalink to &quot;å¿«é€Ÿä¸Šæ‰‹&quot;">â€‹</a></h2><p>å…ˆå‡†å¤‡ä¸¤ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªåŸºåº§åº”ç”¨ <code>vite-vue3-base-app</code> ï¼Œ ä¸€ä¸ªå­åº”ç”¨ <code>vite-vue3-sub-app</code> ï¼Œæ­¤å¤„å‡é€‰æ‹© <code>vite+vue3</code> ä½œä¸ºæ¨¡æ¿ã€‚</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vue@latest</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vue@latest</span></span></code></pre></div><h3 id="åŸºåº§åº”ç”¨" tabindex="-1">åŸºåº§åº”ç”¨ <a class="header-anchor" href="#åŸºåº§åº”ç”¨" aria-label="Permalink to &quot;åŸºåº§åº”ç”¨&quot;">â€‹</a></h3><p>1ã€ å®‰è£…ä¾èµ–</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@micro-zoe/micro-app</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@micro-zoe/micro-app</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save</span></span></code></pre></div><p>2ã€ å…¥å£å¼•å…¥ å¹¶åˆå§‹åŒ–</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> microApp </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@micro-zoe/micro-app&#39;</span></span>
<span class="line"><span style="color:#6A737D;">// start</span></span>
<span class="line"><span style="color:#E1E4E8;">microApp.</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> microApp </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@micro-zoe/micro-app&#39;</span></span>
<span class="line"><span style="color:#6A737D;">// start</span></span>
<span class="line"><span style="color:#24292E;">microApp.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">()</span></span></code></pre></div><p>3ã€ åˆ†é…ä¸€ä¸ªè·¯ç”±ç»™å­åº”ç”¨</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// router.js</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> VueRouter </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vue-router&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> MyPage </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./my-page.vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Vue.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(VueRouter)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">routes</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ğŸ‘‡ éä¸¥æ ¼åŒ¹é…ï¼Œ/my-page/* éƒ½æŒ‡å‘ MyPage é¡µé¢</span></span>
<span class="line"><span style="color:#E1E4E8;">    path: </span><span style="color:#9ECBFF;">&#39;/my-page/:page*&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// vue-router@4.x pathçš„å†™æ³•ä¸ºï¼š&#39;/my-page/:page*&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    name: </span><span style="color:#9ECBFF;">&#39;my-page&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    component: MyPage,</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> routes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// router.js</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> VueRouter </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vue-router&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> MyPage </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./my-page.vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Vue.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(VueRouter)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">routes</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ğŸ‘‡ éä¸¥æ ¼åŒ¹é…ï¼Œ/my-page/* éƒ½æŒ‡å‘ MyPage é¡µé¢</span></span>
<span class="line"><span style="color:#24292E;">    path: </span><span style="color:#032F62;">&#39;/my-page/:page*&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">// vue-router@4.x pathçš„å†™æ³•ä¸ºï¼š&#39;/my-page/:page*&#39;</span></span>
<span class="line"><span style="color:#24292E;">    name: </span><span style="color:#032F62;">&#39;my-page&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    component: MyPage,</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> routes</span></span></code></pre></div><p>4ã€ åœ¨ MyPage é¡µé¢åµŒå…¥å­åº”ç”¨</p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- my-page.vue --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;å­åº”ç”¨&lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">&lt;!-- </span></span>
<span class="line"><span style="color:#6A737D;">      name(å¿…ä¼ )ï¼šåº”ç”¨åç§°</span></span>
<span class="line"><span style="color:#6A737D;">      url(å¿…ä¼ )ï¼šåº”ç”¨åœ°å€ï¼Œä¼šè¢«è‡ªåŠ¨è¡¥å…¨ä¸ºhttp://localhost:5173/index.html</span></span>
<span class="line"><span style="color:#6A737D;">      baseroute(å¯é€‰)ï¼šåŸºåº§åº”ç”¨åˆ†é…ç»™å­åº”ç”¨çš„åŸºç¡€è·¯ç”±ï¼Œå°±æ˜¯ä¸Šé¢çš„ \`/my-page\`</span></span>
<span class="line"><span style="color:#6A737D;">     --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">micro-app</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&#39;app1&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&#39;http://localhost:5173/&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">baseroute</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&#39;/my-page&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- my-page.vue --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;å­åº”ç”¨&lt;/</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">&lt;!-- </span></span>
<span class="line"><span style="color:#6A737D;">      name(å¿…ä¼ )ï¼šåº”ç”¨åç§°</span></span>
<span class="line"><span style="color:#6A737D;">      url(å¿…ä¼ )ï¼šåº”ç”¨åœ°å€ï¼Œä¼šè¢«è‡ªåŠ¨è¡¥å…¨ä¸ºhttp://localhost:5173/index.html</span></span>
<span class="line"><span style="color:#6A737D;">      baseroute(å¯é€‰)ï¼šåŸºåº§åº”ç”¨åˆ†é…ç»™å­åº”ç”¨çš„åŸºç¡€è·¯ç”±ï¼Œå°±æ˜¯ä¸Šé¢çš„ \`/my-page\`</span></span>
<span class="line"><span style="color:#6A737D;">     --&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">micro-app</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;app1&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">url</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;http://localhost:5173/&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">baseroute</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;/my-page&#39;</span></span>
<span class="line"><span style="color:#24292E;">    /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><h3 id="å­åº”ç”¨" tabindex="-1">å­åº”ç”¨ <a class="header-anchor" href="#å­åº”ç”¨" aria-label="Permalink to &quot;å­åº”ç”¨&quot;">â€‹</a></h3><p>1ã€ è®¾ç½®åŸºç¡€è·¯ç”±</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> VueRouter </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vue-router&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> routes </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./router&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createRouter</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ğŸ‘‡ è®¾ç½®åŸºç¡€è·¯ç”±ï¼Œå­åº”ç”¨å¯ä»¥é€šè¿‡window.__MICRO_APP_BASE_ROUTE__è·å–åŸºåº§ä¸‹å‘çš„baserouteï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®baserouteå±æ€§ï¼Œåˆ™æ­¤å€¼é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#E1E4E8;">  base: window.__MICRO_APP_BASE_ROUTE__ </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.env.</span><span style="color:#79B8FF;">BASE_URL</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  routes,</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Vue</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  router,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">h</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">h</span><span style="color:#E1E4E8;">(App),</span></span>
<span class="line"><span style="color:#E1E4E8;">}).</span><span style="color:#B392F0;">$mount</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;#app&#39;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> VueRouter </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vue-router&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> routes </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./router&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createRouter</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ğŸ‘‡ è®¾ç½®åŸºç¡€è·¯ç”±ï¼Œå­åº”ç”¨å¯ä»¥é€šè¿‡window.__MICRO_APP_BASE_ROUTE__è·å–åŸºåº§ä¸‹å‘çš„baserouteï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®baserouteå±æ€§ï¼Œåˆ™æ­¤å€¼é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#24292E;">  base: window.__MICRO_APP_BASE_ROUTE__ </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.env.</span><span style="color:#005CC5;">BASE_URL</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  routes,</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> app </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Vue</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  router,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">render</span><span style="color:#24292E;">: </span><span style="color:#E36209;">h</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">h</span><span style="color:#24292E;">(App),</span></span>
<span class="line"><span style="color:#24292E;">}).</span><span style="color:#6F42C1;">$mount</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;#app&#39;</span><span style="color:#24292E;">)</span></span></code></pre></div><p>2ã€ è·¨åŸŸé—®é¢˜</p><p>ä½¿ç”¨ <code>vite</code> é»˜è®¤æ”¯æŒ <code>cors</code> ï¼Œå³ <code>server.cors = true</code></p><p>å®Œæˆä»¥ä¸Šè®¾ç½®å³å¯æ­£å¸¸åŠ è½½å­åº”ç”¨äº†ï¼Œä½†æ˜¯ç”±äºåŸºåº§ä¸å­åº”ç”¨éƒ½ä½¿ç”¨çš„ <code>vite</code> ï¼Œ<code>micro-app@0.8</code> å¯¹ <code>vite</code> çš„æ”¯æŒå¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œè¿˜éœ€è¦åšæ›´å¤šçš„å…¼å®¹å¤„ç†ã€‚</p><h3 id="vite-æ˜¯-å­åº”ç”¨-æ—¶çš„-åŸºåº§åº”ç”¨-å…¼å®¹å¤„ç†" tabindex="-1">vite æ˜¯ å­åº”ç”¨ æ—¶çš„ åŸºåº§åº”ç”¨ å…¼å®¹å¤„ç† <a class="header-anchor" href="#vite-æ˜¯-å­åº”ç”¨-æ—¶çš„-åŸºåº§åº”ç”¨-å…¼å®¹å¤„ç†" aria-label="Permalink to &quot;vite æ˜¯ å­åº”ç”¨ æ—¶çš„ åŸºåº§åº”ç”¨ å…¼å®¹å¤„ç†&quot;">â€‹</a></h3><p>å¯¹äº å­åº”ç”¨ æ˜¯ <code>vite</code> åº”ç”¨çš„ï¼Œ è¿˜éœ€è¦å¯¹ åŸºåº§åº”ç”¨ åšä¿®æ”¹</p><p>1ã€ å…³é—­æ²™ç®±å¹¶ä½¿ç”¨å†…è” <code>script</code></p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- inline ä½¿ç”¨å†…è” script æ¨¡å¼ --&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!-- disableSandbox å…³é—­æ²™ç®± --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">micro-app</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&#39;app1&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&#39;http://localhost:5174/&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">baseroute</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&#39;/my-page&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">inline</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">disableSandbox</span></span>
<span class="line"><span style="color:#E1E4E8;">  &gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- inline ä½¿ç”¨å†…è” script æ¨¡å¼ --&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!-- disableSandbox å…³é—­æ²™ç®± --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">micro-app</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;app1&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">url</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;http://localhost:5174/&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">baseroute</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&#39;/my-page&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">inline</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">disableSandbox</span></span>
<span class="line"><span style="color:#24292E;">  &gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>2ã€ å¤„ç†å­åº”ç”¨é™æ€èµ„æº</p><p>å†™ä¸€ä¸ªç®€æ˜“çš„æ’ä»¶ï¼Œå¯¹å¼€å‘ç¯å¢ƒçš„å­åº”ç”¨è¿›è¡Œå¤„ç†ï¼Œè¡¥å…¨é™æ€èµ„æºè·¯å¾„ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ä¸»åº”ç”¨ main.js</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> microApp </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@micro-zoe/micro-app&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å­åº”ç”¨ å¼€å‘ ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">subAppDevServer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// å’Œå­åº”ç”¨vite.config.jsä¸­baseçš„é…ç½®ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="color:#E1E4E8;">  base: </span><span style="color:#9ECBFF;">&#39;/child/vite/&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// å­åº”ç”¨ç«¯å£å·</span></span>
<span class="line"><span style="color:#E1E4E8;">  port: </span><span style="color:#9ECBFF;">&#39;5174&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">microApp.</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  plugins: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    modules: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// app1 å³å­åº”ç”¨çš„ name å€¼</span></span>
<span class="line"><span style="color:#E1E4E8;">      app1: [{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">loader</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">code</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (p<wbr>rocess.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;development&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// è¿™é‡Œ /child/vite/ éœ€è¦å’Œå­åº”ç”¨vite.config.jsä¸­baseçš„é…ç½®ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="color:#E1E4E8;">            code </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> code.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">(from</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">import)(</span><span style="color:#79B8FF;">\\s</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">[&#39;&quot;]</span><span style="color:#DBEDFF;">)(</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">child</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">vite</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">)</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">g</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">protocol</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">hostname</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> window.location</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">devUrl</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`\${</span><span style="color:#E1E4E8;">protocol</span><span style="color:#9ECBFF;">}//\${</span><span style="color:#E1E4E8;">hostname</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">subAppDevServer</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">port</span><span style="color:#9ECBFF;">}\${</span><span style="color:#E1E4E8;">subAppDevServer</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">base</span><span style="color:#9ECBFF;">}\`</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> all.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(subAppDevServer.base, devUrl)</span></span>
<span class="line"><span style="color:#E1E4E8;">            })</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> code</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ä¸»åº”ç”¨ main.js</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> microApp </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@micro-zoe/micro-app&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å­åº”ç”¨ å¼€å‘ ä¿¡æ¯</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">subAppDevServer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// å’Œå­åº”ç”¨vite.config.jsä¸­baseçš„é…ç½®ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="color:#24292E;">  base: </span><span style="color:#032F62;">&#39;/child/vite/&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// å­åº”ç”¨ç«¯å£å·</span></span>
<span class="line"><span style="color:#24292E;">  port: </span><span style="color:#032F62;">&#39;5174&#39;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">microApp.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  plugins: {</span></span>
<span class="line"><span style="color:#24292E;">    modules: {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// app1 å³å­åº”ç”¨çš„ name å€¼</span></span>
<span class="line"><span style="color:#24292E;">      app1: [{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">loader</span><span style="color:#24292E;">(</span><span style="color:#E36209;">code</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (p<wbr>rocess.env.</span><span style="color:#005CC5;">NODE_ENV</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;development&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// è¿™é‡Œ /child/vite/ éœ€è¦å’Œå­åº”ç”¨vite.config.jsä¸­baseçš„é…ç½®ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="color:#24292E;">            code </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> code.</span><span style="color:#6F42C1;">replace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">/(from</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">import)(</span><span style="color:#005CC5;">\\s</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">[&#39;&quot;]</span><span style="color:#032F62;">)(</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">child</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">vite</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">)/</span><span style="color:#D73A49;">g</span><span style="color:#24292E;">, </span><span style="color:#E36209;">all</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">protocol</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">hostname</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> window.location</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">devUrl</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`\${</span><span style="color:#24292E;">protocol</span><span style="color:#032F62;">}//\${</span><span style="color:#24292E;">hostname</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">subAppDevServer</span><span style="color:#032F62;">.</span><span style="color:#24292E;">port</span><span style="color:#032F62;">}\${</span><span style="color:#24292E;">subAppDevServer</span><span style="color:#032F62;">.</span><span style="color:#24292E;">base</span><span style="color:#032F62;">}\`</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> all.</span><span style="color:#6F42C1;">replace</span><span style="color:#24292E;">(subAppDevServer.base, devUrl)</span></span>
<span class="line"><span style="color:#24292E;">            })</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> code</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">      }]</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><p>3ã€ è‡ªå®šä¹‰æ ‡ç­¾é—®é¢˜å¤„ç†</p><p>åŸºåº§åº”ç”¨ ä¼šæŠ¥é”™ <code>micro-app</code> æœªå®šä¹‰ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹è‡ªå®šä¹‰æ ‡ç­¾å¤„ç†</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { defineConfig } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vite&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> vueJsx </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-vue-jsx&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defineConfig</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  plugins: [</span><span style="color:#B392F0;">vue</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    template: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      compilerOptions: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">isCustomElement</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">tag</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">^</span><span style="color:#DBEDFF;">micro-app</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(tag)</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }), </span><span style="color:#B392F0;">vueJsx</span><span style="color:#E1E4E8;">()],</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { defineConfig } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vite&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> vueJsx </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-vue-jsx&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defineConfig</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  plugins: [</span><span style="color:#6F42C1;">vue</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    template: {</span></span>
<span class="line"><span style="color:#24292E;">      compilerOptions: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">isCustomElement</span><span style="color:#24292E;">: </span><span style="color:#E36209;">tag</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#032F62;"> /</span><span style="color:#D73A49;">^</span><span style="color:#032F62;">micro-app/</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">test</span><span style="color:#24292E;">(tag)</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }), </span><span style="color:#6F42C1;">vueJsx</span><span style="color:#24292E;">()],</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><h3 id="vite-å­åº”ç”¨çš„å…¼å®¹å¤„ç†" tabindex="-1">vite å­åº”ç”¨çš„å…¼å®¹å¤„ç† <a class="header-anchor" href="#vite-å­åº”ç”¨çš„å…¼å®¹å¤„ç†" aria-label="Permalink to &quot;vite å­åº”ç”¨çš„å…¼å®¹å¤„ç†&quot;">â€‹</a></h3><p>å½“å­åº”ç”¨æ˜¯ <code>vite</code> åº”ç”¨æ—¶éœ€è¦åšç‰¹åˆ«çš„é€‚é…ï¼Œ<code>micro-app@0.8</code> é€‚é… <code>vite</code> æ”¹åŠ¨éå¸¸å¤§ï¼Œæˆ‘ä»¬å¿…é¡»å…³é—­æ²™ç®±åŠŸèƒ½ï¼Œå› ä¸ºæ²™ç®±åœ¨ <code>module script</code> ä¸‹ä¸æ”¯æŒï¼Œè¿™å¯¼è‡´å¤§éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>ç¯å¢ƒå˜é‡</li><li>æ ·å¼åˆ†å‰²</li><li>å…ƒç´ åˆ†å‰²</li><li>èµ„æºè·¯å¾„è¡¥å…¨ã€</li><li><code>baseroute</code> ç­‰ã€‚</li></ul><p>åœ¨åµŒå…¥ <code>vite</code> å­åº”ç”¨æ—¶ï¼Œ<code>micro-app</code> çš„åŠŸèƒ½åªè´Ÿè´£æ¸²æŸ“ï¼Œå…¶å®ƒçš„è¡Œä¸ºç”±åº”ç”¨è‡ªè¡Œå†³å®šï¼Œè¿™åŒ…æ‹¬å¦‚ä½•é˜²æ­¢æ ·å¼ã€<code>JS</code> å˜é‡ã€å…ƒç´ çš„äº’ç›¸å½±å“ã€‚</p><p>åœ¨ <code>module</code> æ¨¡å¼ä¸‹ï¼Œå¼•å…¥çš„èµ„æºå¤§å¤šä¸ºç›¸å¯¹åœ°å€ï¼Œå…¼å®¹ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯å°†åœ°å€è¡¥å…¨ã€‚</p><p>1ã€ ä¿®æ”¹ vite.config.js</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { fileURLToPath } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;node:url&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { defineConfig } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vite&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> vueJsx </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-vue-jsx&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { join } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;node:path&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { writeFileSync } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;node:fs&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defineConfig</span><span style="color:#E1E4E8;">(({ </span><span style="color:#FFAB70;">command</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">mode</span><span style="color:#E1E4E8;"> })</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// æ”¹æˆ function å½¢å¼</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;----[vite.config.js]---&#39;</span><span style="color:#E1E4E8;">, command, mode, p<wbr>rocess.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ç¯å¢ƒåˆ¤æ–­</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">isDev</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> p<wbr>rocess.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;development&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">isProd</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> p<wbr>rocess.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;production&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">base</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">isDev</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> isProd</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;http://ç”Ÿäº§åœ°å€&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;http://dev/qa-åœ°å€&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/child/vite/&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    base,</span></span>
<span class="line"><span style="color:#E1E4E8;">    plugins: [</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">vue</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">vueJsx</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">      (</span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> basePath </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">          name: </span><span style="color:#9ECBFF;">&#39;vite:micro-app&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">          apply: </span><span style="color:#9ECBFF;">&#39;build&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">configResolved</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">config</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;----[my plugin]----&#39;</span><span style="color:#E1E4E8;">, config.base, config.build.assetsDir)</span></span>
<span class="line"><span style="color:#E1E4E8;">            basePath </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`\${</span><span style="color:#E1E4E8;">config</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">base</span><span style="color:#9ECBFF;">}\${</span><span style="color:#E1E4E8;">config</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">build</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">assetsDir</span><span style="color:#9ECBFF;">}/\`</span></span>
<span class="line"><span style="color:#E1E4E8;">          },</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">writeBundle</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">bundle</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">chunkName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> bundle) {</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">Object</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">prototype</span><span style="color:#E1E4E8;">.hasOwnProperty.</span><span style="color:#B392F0;">call</span><span style="color:#E1E4E8;">(bundle, chunkName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">chunk</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> bundle[chunkName]</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (chunk.fileName </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> chunk.fileName.</span><span style="color:#B392F0;">endsWith</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.js&#39;</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                  chunk.code </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> chunk.code.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">(from</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">import</span><span style="color:#85E89D;font-weight:bold;">\\(</span><span style="color:#DBEDFF;">)(</span><span style="color:#79B8FF;">\\s</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">[&#39;&quot;]</span><span style="color:#DBEDFF;">)(</span><span style="color:#85E89D;font-weight:bold;">\\.\\.</span><span style="color:#F97583;">?</span><span style="color:#85E89D;font-weight:bold;">\\/</span><span style="color:#DBEDFF;">)</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">g</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">all</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">$1</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">$2</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">$3</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;---[plugin write]---&#39;</span><span style="color:#E1E4E8;">, $3, basePath)</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> all.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">($3, </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">($3, basePath))</span></span>
<span class="line"><span style="color:#E1E4E8;">                  })</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fullPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(options.dir, chunk.fileName)</span></span>
<span class="line"><span style="color:#E1E4E8;">                  </span><span style="color:#B392F0;">writeFileSync</span><span style="color:#E1E4E8;">(fullPath, chunk.code)</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">              }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">      })()</span></span>
<span class="line"><span style="color:#E1E4E8;">    ],</span></span>
<span class="line"><span style="color:#E1E4E8;">    resolve: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      alias: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;@&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">fileURLToPath</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./src&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url))</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { fileURLToPath } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;node:url&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { defineConfig } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vite&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> vueJsx </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-vue-jsx&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { join } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;node:path&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { writeFileSync } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;node:fs&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defineConfig</span><span style="color:#24292E;">(({ </span><span style="color:#E36209;">command</span><span style="color:#24292E;">, </span><span style="color:#E36209;">mode</span><span style="color:#24292E;"> })</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// æ”¹æˆ function å½¢å¼</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;----[vite.config.js]---&#39;</span><span style="color:#24292E;">, command, mode, p<wbr>rocess.env.</span><span style="color:#005CC5;">NODE_ENV</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ç¯å¢ƒåˆ¤æ–­</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">isDev</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p<wbr>rocess.env.</span><span style="color:#005CC5;">NODE_ENV</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;development&#39;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">isProd</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p<wbr>rocess.env.</span><span style="color:#005CC5;">NODE_ENV</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;production&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">base</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!</span><span style="color:#24292E;">isDev</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> isProd</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;http://ç”Ÿäº§åœ°å€&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;http://dev/qa-åœ°å€&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/child/vite/&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    base,</span></span>
<span class="line"><span style="color:#24292E;">    plugins: [</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">vue</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">vueJsx</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">      (</span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> basePath </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">          name: </span><span style="color:#032F62;">&#39;vite:micro-app&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          apply: </span><span style="color:#032F62;">&#39;build&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">configResolved</span><span style="color:#24292E;">(</span><span style="color:#E36209;">config</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;----[my plugin]----&#39;</span><span style="color:#24292E;">, config.base, config.build.assetsDir)</span></span>
<span class="line"><span style="color:#24292E;">            basePath </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`\${</span><span style="color:#24292E;">config</span><span style="color:#032F62;">.</span><span style="color:#24292E;">base</span><span style="color:#032F62;">}\${</span><span style="color:#24292E;">config</span><span style="color:#032F62;">.</span><span style="color:#24292E;">build</span><span style="color:#032F62;">.</span><span style="color:#24292E;">assetsDir</span><span style="color:#032F62;">}/\`</span></span>
<span class="line"><span style="color:#24292E;">          },</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">writeBundle</span><span style="color:#24292E;">(</span><span style="color:#E36209;">options</span><span style="color:#24292E;">, </span><span style="color:#E36209;">bundle</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">chunkName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> bundle) {</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">Object</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">prototype</span><span style="color:#24292E;">.hasOwnProperty.</span><span style="color:#6F42C1;">call</span><span style="color:#24292E;">(bundle, chunkName)) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">chunk</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> bundle[chunkName]</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (chunk.fileName </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> chunk.fileName.</span><span style="color:#6F42C1;">endsWith</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;.js&#39;</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">                  chunk.code </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> chunk.code.</span><span style="color:#6F42C1;">replace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">/(from</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">import</span><span style="color:#22863A;font-weight:bold;">\\(</span><span style="color:#032F62;">)(</span><span style="color:#005CC5;">\\s</span><span style="color:#D73A49;">*</span><span style="color:#005CC5;">[&#39;&quot;]</span><span style="color:#032F62;">)(</span><span style="color:#22863A;font-weight:bold;">\\.\\.</span><span style="color:#D73A49;">?</span><span style="color:#22863A;font-weight:bold;">\\/</span><span style="color:#032F62;">)/</span><span style="color:#D73A49;">g</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">all</span><span style="color:#24292E;">, </span><span style="color:#E36209;">$1</span><span style="color:#24292E;">, </span><span style="color:#E36209;">$2</span><span style="color:#24292E;">, </span><span style="color:#E36209;">$3</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;---[plugin write]---&#39;</span><span style="color:#24292E;">, $3, basePath)</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> all.</span><span style="color:#6F42C1;">replace</span><span style="color:#24292E;">($3, </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">($3, basePath))</span></span>
<span class="line"><span style="color:#24292E;">                  })</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fullPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(options.dir, chunk.fileName)</span></span>
<span class="line"><span style="color:#24292E;">                  </span><span style="color:#6F42C1;">writeFileSync</span><span style="color:#24292E;">(fullPath, chunk.code)</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">              }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">      })()</span></span>
<span class="line"><span style="color:#24292E;">    ],</span></span>
<span class="line"><span style="color:#24292E;">    resolve: {</span></span>
<span class="line"><span style="color:#24292E;">      alias: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;@&#39;</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">fileURLToPath</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./src&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url))</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div><p>2ã€ ä¿®æ”¹å®¹å™¨å…ƒç´  <code>id</code> å¹¶ä½¿ç”¨æ–°çš„ <code>id</code> æ¸²æŸ“</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- index.html --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;my-vite-app&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- index.html --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">body</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;my-vite-app&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">body</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#B392F0;">createApp</span><span style="color:#E1E4E8;">(App).</span><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;#my-vite-app&#39;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#6F42C1;">createApp</span><span style="color:#24292E;">(App).</span><span style="color:#6F42C1;">mount</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;#my-vite-app&#39;</span><span style="color:#24292E;">)</span></span></code></pre></div><p>å½“å¤šä¸ª <code>vite</code> å­åº”ç”¨åŒæ—¶æ¸²æŸ“æ—¶ï¼Œå¿…é¡»ä¿®æ”¹å®¹å™¨å…ƒç´ çš„ <code>id</code> å€¼ï¼Œç¡®ä¿æ¯ä¸ªå­åº”ç”¨å®¹å™¨å…ƒç´  <code>id</code> çš„å”¯ä¸€æ€§ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸æ¸²æŸ“ã€‚</p><p>3ã€ å›¾ç‰‡é™æ€èµ„æºå¤„ç†</p><p>ä¾‹å¦‚å¤„ç† <code>logo</code> å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥å°è£…æˆé€šç”¨å‡½æ•°ï¼Œç»Ÿä¸€å¤„ç†</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Logo </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@/assets/logo.svg&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// è·å–åŸºæœ¬è·¯å¾„ï¼Œç”¨äºå°†å›¾ç‰‡ç›¸å¯¹è·¯å¾„æ”¹æˆç»å¯¹è·¯å¾„</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getBaseUrlToImg</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;---[img]---&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">isProd</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> p<wbr>rocess.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;production&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">index</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url.</span><span style="color:#B392F0;">indexOf</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    isProd </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/app1&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/child/vite/&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  )</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">basePath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`\${</span><span style="color:#E1E4E8;">isProd</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">?</span><span style="color:#9ECBFF;"> </span><span style="color:#9ECBFF;">&#39;/app1&#39;</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">:</span><span style="color:#9ECBFF;"> </span><span style="color:#9ECBFF;">&#39;/child/vite/&#39;}src/\`</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url.</span><span style="color:#B392F0;">slice</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, index) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> basePath</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">// å›¾ç‰‡è·¯å¾„</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">logoImg</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> p<wbr>rocess.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;production&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(Logo, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`\${</span><span style="color:#B392F0;">getBaseUrlToImg</span><span style="color:#9ECBFF;">()</span><span style="color:#9ECBFF;">}assets/logo.svg\`</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Logo </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@/assets/logo.svg&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// è·å–åŸºæœ¬è·¯å¾„ï¼Œç”¨äºå°†å›¾ç‰‡ç›¸å¯¹è·¯å¾„æ”¹æˆç»å¯¹è·¯å¾„</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getBaseUrlToImg</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;---[img]---&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">isProd</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p<wbr>rocess.env.</span><span style="color:#005CC5;">NODE_ENV</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;production&#39;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">index</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url.</span><span style="color:#6F42C1;">indexOf</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    isProd </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/app1&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/child/vite/&#39;</span></span>
<span class="line"><span style="color:#24292E;">  )</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">basePath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`\${</span><span style="color:#24292E;">isProd</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">?</span><span style="color:#032F62;"> </span><span style="color:#032F62;">&#39;/app1&#39;</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">:</span><span style="color:#032F62;"> </span><span style="color:#032F62;">&#39;/child/vite/&#39;}src/\`</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url.</span><span style="color:#6F42C1;">slice</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, index) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> basePath</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">// å›¾ç‰‡è·¯å¾„</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">logoImg</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p<wbr>rocess.env.</span><span style="color:#005CC5;">NODE_ENV</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;production&#39;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(Logo, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`\${</span><span style="color:#6F42C1;">getBaseUrlToImg</span><span style="color:#032F62;">()</span><span style="color:#032F62;">}assets/logo.svg\`</span></span></code></pre></div><h2 id="micro-app-1-x" tabindex="-1">micro-app 1.x <a class="header-anchor" href="#micro-app-1-x" aria-label="Permalink to &quot;micro-app 1.x&quot;">â€‹</a></h2><p><a href="https://micro-zoe.github.io/micro-app/" target="_blank" rel="noreferrer">micro-app</a>å·²æ›´æ–°è‡³ <code>1.x beta</code> ç‰ˆï¼Œå…¼å®¹ <code>vite</code> å­åº”ç”¨ä¸éœ€è¦å†è¿›è¡Œè¿‡å¤šçš„ä¿®æ”¹å¤„ç†ã€‚</p><p><code>micro-app</code> å€Ÿé‰´ <code>WebComponent</code> çš„æ€æƒ³ï¼Œé€šè¿‡ <code>CustomElement</code> ç»“åˆè‡ªå®šä¹‰çš„ <code>ShadowDom</code> ï¼Œå°†å¾®å‰ç«¯å°è£…æˆä¸€ä¸ªç±» <code>WebComponent</code> ç»„ä»¶ï¼Œå®ç°å¾®å‰ç«¯çš„ç»„ä»¶åŒ–æ¸²æŸ“ã€‚</p><ul><li><p><code>js</code> æ²™ç®±</p><p>ä¸ <code>qiankun</code> ä¸€æ ·ï¼Œ <code>micro-app</code> é‡‡ç”¨ <code>proxy</code> + <code>with</code> çš„æ²™ç®±æ–¹æ¡ˆï¼Œä½†ä¹Ÿä½¿ç”¨ <code>Object.defineProperty</code> å®šä¹‰å…¨å±€å˜é‡ï¼Œä»¥å‡å°‘ <code>proxy</code> å¸¦æ¥çš„æ€§èƒ½æŸè€—</p></li><li><p><code>css</code> éš”ç¦»</p><p>é€šè¿‡ç»™å­åº”ç”¨æ·»åŠ å±æ€§é€‰æ‹©å™¨æ¥å®ç°æ ·å¼éš”ç¦»ï¼Œä¾‹å¦‚</p><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">color</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">black</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/* æ·»åŠ å±æ€§é€‰æ‹©å™¨ */</span></span>
<span class="line"><span style="color:#85E89D;">micro-app</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">app</span><span style="color:#E1E4E8;">] </span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">color</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">black</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">main</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">color</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">black</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/* æ·»åŠ å±æ€§é€‰æ‹©å™¨ */</span></span>
<span class="line"><span style="color:#22863A;">micro-app</span><span style="color:#24292E;">[</span><span style="color:#6F42C1;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">app</span><span style="color:#24292E;">] </span><span style="color:#22863A;">main</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">color</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">black</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></li><li><p>è™šæ‹Ÿè·¯ç”±ç³»ç»Ÿ</p><p>è‡ªå®šä¹‰ <code>location</code> å’Œ <code>history</code> ç­‰æ ¸å¿ƒè·¯ç”± <code>api</code> ï¼Œé‡å†™äº† <code>popState</code> å’Œ <code>hashChange</code> äº‹ä»¶ï¼Œæ‹¦æˆªå¯¼èˆªå’Œäº‹ä»¶ã€‚åŸºåº§åº”ç”¨èƒ½æ–¹ä¾¿çš„è·å–å­åº”ç”¨çš„è·¯ç”±ä¿¡æ¯å¹¶æ§åˆ¶å­åº”ç”¨è·³è½¬ï¼Œå­åº”ç”¨çš„è·¯ç”±ä¿¡æ¯ä¹Ÿä¼šä½œä¸ºå‚æ•°åŒæ­¥åˆ°æµè§ˆå™¨åœ°å€æ </p></li><li><p><code>vite</code> çš„å…¼å®¹</p><p>ä¹‹å‰çš„ç‰ˆæœ¬è¦æ”¯æŒ <code>vite</code> å¿…é¡»å…³é—­æ²™ç®±ï¼Œå› ä¸º <code>vite</code> æ‰“åŒ…å‡ºæ¥çš„ <code>esm</code> ç±»å‹çš„ <code>js</code> æ–‡ä»¶ï¼Œæ— æ³•è¿è¡Œåœ¨ <code>with</code> ç¯å¢ƒä¸­ï¼Œæ•…é‡‡ç”¨äº† <code>iframe</code> æ²™ç®±æ–¹æ¡ˆåšå…¼å®¹ã€‚</p></li></ul><h2 id="source" tabindex="-1">Source <a class="header-anchor" href="#source" aria-label="Permalink to &quot;Source&quot;">â€‹</a></h2><ul><li><a href="https://gitee.com/lafen/micro-app-vite-vue3-demo" target="_blank" rel="noreferrer">Demo</a></li><li><a href="https://github.com/micro-zoe/micro-app-demo" target="_blank" rel="noreferrer">Repo</a></li><li><a href="https://zhuanlan.zhihu.com/p/661541867" target="_blank" rel="noreferrer">Post</a></li></ul>`,53),e=[o];function c(t,r,E,y,i,F){return n(),a("div",null,e)}const m=s(l,[["render",c]]);export{u as __pageData,m as default};
