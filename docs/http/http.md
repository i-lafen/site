# HTTP/0.9/1.0/1.1/2/3

## HTTP/0.9 超文本传输协议

`1991` 年提出，只是用来在网络之间传递 `html` 超文本内容，所以被称作 **超文本传输协议**。特点：

- 只有 `GET` 请求，且只有 请求行 `GET /index.html` ，并没有请求头和请求体。
- 没有 响应头。
- 返回文件内容以 `ASCII` 字符流传输，因为都是 `html` 格式的文件

### 缺点

- 只能使用 **GET 简单请求 html**，无法满足日益发展的 `web` 页面数据传输。如： `js` 、 `css` 、图片、音频、视频 等。



## HTTP/1.0

### 背景

浏览器中展示不单单是 `html` 文件，还包括了 `js`、`css`、图片、音频、视频 等不同类型的文件，因此支持多种 文件类型、编码 是 `HTTP/1.0` 的一个核心诉求。

### 实现

引入 **请求头** 和 **响应头** ，以 `key-value` 的形式来互相告知如何处理数据。

### 特点

- 增加 **请求头** 和 **响应头**
- 支持多种 **数据类型**、**编码**，`content-type` 常见值： `text/html` 、 `application/json`
- 新增 **状态码**
- 利用 **cache 机制缓存**下载过的数据
- 增加**用户代理字段**
- 多语言支持
- 支持文件压缩

### 缺点

- 无持久连接。一个丰富的页面可能存在几十上百个请求，每次请求都要通过 `tcp` 的 三次握手、四次挥手，多个请求会导致开关 `tcp` 连接频繁耗时。因此要继续发展 `http/1.1`



## HTTP/1.1

### 背景

`tcp` 频繁连接耗时，需要提供 **持久连接** 能力，即一个 `tcp` 连接上传输 多个 `http` 请求。

### 特点

- **一个 tcp 连接可传输多个 http**，减少服务器负担、降低 `http` 请求时长。
- 默认开启持久连接，`Connection: keep-alive`。
- 对于同一域名，默认允许同时建立 **6 个 tcp 持久连接**。
- 使用 `CDN` 的实现域名分片机制，可以实现更多连接。

### 缺点

- **队头阻塞**。持久连接虽然能减少 `tcp` 连接断开次数，但是它需要前面的请求返回后才能进行下一次请求。如果 `tcp` 通道中某个请求因为某些原因没有及时返回，就会阻塞后面的所有请求。
- **tcp 慢启动**，下载网速类比汽车 `0-100km/h` 加速过程。对于页面中的很小的关键资源 `js`、`css` 等耗时较长。
- **多条 TCP 连接会导致带宽竞争**。多个 `tcp` 连接的发送和接收速度在慢慢增加，而一旦带宽不足，`tcp` 连接又会减慢发送或接收的速度。导致 图片、音频等 会抢夺 关键资源 （如：`js`、`css`） 的 `tcp` 带宽，`tcp` 连接之间又不能协商让哪些关键资源有限下载，就可能会影响了那些关键资源的下载。



## HTTP/2

### 背景

慢启动 和 `tcp` 连接之间互相竞争 带宽 是由于 `tcp` 本身的机制导致的，而队头阻塞是由于 `http/1.1` 的机制导致的。

为此 `http/2` 提出了 **多路复用** 功能。基本思路是：

- 一个域名只使用一个 `tcp` 长连接 来传输数据，只需一次 慢启动，同时避免 带宽竞争。
- 资源并行请求，随时发送接收，解决 队头阻塞问题。

### 特点

- **多路复用技术**。基于 **二进制分帧层**。即在协议栈中增加二进制分帧层，标记、解析 资源 `id` 。
- **可以设置请求优先级**。基于 二进制分帧层，标记请求优先处理。
- **服务器推送**。当服务器处理一个 `html` 请求时，附带将页面上的 `js`、`css` 等重要资源一并发送回来。
- **头部压缩**。大部分资源请求都是只有 请求头，压缩请求头可提高传输效率。

### 缺点

- **tcp 的队头阻塞**。底层 `tcp` 协议仍是 管道传输，且只有一个 `tcp` 连接，丢包时需要等待重发，丢包率达到 `2%` 时，`http/1.1` 的 `6` 个 `tcp` 连接 比 `http/2` 效率高。
- **tcp、tls 连接耗时**。`tcp` 协议始终需要 三次握手、四次挥手来建立连接。如果时 `https` 的话，还需要 进行 `TLS` 连接耗时。
- **协议僵化**。操作系统 和 网络中间设备（路由器、防火墙、交换机等）的 `tcp` 协议许久无优化。即使我们客户端升级了 `tcp` 协议，但是当新协议的 数据包经过这些中间设备时，可能不被识别而丢弃。



## HTTP/3

### 背景

`tcp` 队头阻塞 、 连接耗时 和 协议僵化 无可避免，故 基于 `UDP` 协议实现类似于 `TCP` 的多路数据流、传输可靠性等功能。称为 `QUIC` 协议。

### 特点

- 实现类似 `tcp` 的流量控制、传输可靠的功能。 `QUIC` 在 `UDP` 的基础上增加一层来保证数据可靠性传输。它提供了 **数据包重传**、**拥塞控制**及其他 `tcp` 中存在的特性。
- 集成 `TLS` 加密功能，减少建立连接时间。
- 实现 `http/2` 中的 **多路复用** 功能。和 `tcp` 不同， `QUIC` 实现了在同一物理连接上可以有多个独立的逻辑数据流，实现数据流的单独传输，解决 `tcp` 中队头阻塞问题。
- 实现 快速握手。基于 `udp` 协议，提升握手速度。

### 挑战

- 服务器、浏览器未能提供比较完整的支持
- 系统内核对 `UDP` 的优化 远没有达到 `tcp` 的优化程度
- 中间设备僵化，中间设备对 `udp` 的优化程度远低于 `tcp`，`QUIC` 协议丢包率达到了约 `3%-7%`
